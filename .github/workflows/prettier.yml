name: Format

on:
  pull_request:
    branches: [main]

jobs:
  prettier-core:
    name: Prettier Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Check Prettier formatting
        run: |
          PRETTIER_VERSION=$(bun -e 'console.log(require("./package.json").devDependencies.prettier)')
          bunx prettier@$PRETTIER_VERSION --check --log-level warn .

      - name: Show formatting differences
        if: failure()
        run: |
          echo "=== Showing differences for each file ==="
          PRETTIER_VERSION=$(bun -e 'console.log(require("./package.json").devDependencies.prettier)')
          bunx prettier@$PRETTIER_VERSION --write .
          git diff --color=always
